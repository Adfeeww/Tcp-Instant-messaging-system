# TCP 即时通讯系统

基于 Qt 框架开发的客户端/服务器架构即时通讯系统，支持用户注册登录、好友管理、私聊群聊以及文件共享等功能。

## 项目简介

本项目是一个完整的即时通讯系统，采用 TCP 协议进行网络通信，使用 SQLite 数据库存储用户数据。系统分为客户端和服务器两个独立程序，实现了现代即时通讯软件的核心功能。

## 功能特性

### 用户功能
- 用户注册与登录
- 在线用户列表查看
- 搜索用户

### 好友管理
- 添加好友（需对方同意）
- 删除好友
- 刷新好友列表
- 查看好友在线状态

### 聊天功能
- 私聊：与好友进行一对一实时聊天
- 群聊：与所有在线用户进行群组聊天

### 文件共享
- 创建文件夹
- 上传文件
- 下载文件
- 删除文件/文件夹
- 重命名文件
- 刷新文件列表

## 技术栈

- **开发框架**: Qt 6.5.3
- **编程语言**: C++11
- **网络协议**: TCP
- **数据库**: SQLite
- **构建工具**: qmake

## 项目结构

```
Tcp-Instant-messaging-system-main/
├── TcpClient/              # 客户端程序
│   ├── main.cpp           # 客户端入口
│   ├── tcpclient.cpp/h    # 主窗口
│   ├── friend.cpp/h       # 好友管理
│   ├── privatechat.cpp/h  # 私聊窗口
│   ├── online.cpp/h       # 在线用户列表
│   ├── sharefile.cpp/h    # 文件共享
│   ├── book.cpp/h         # 文件管理
│   ├── opewidget.cpp/h    # 操作窗口
│   ├── protocol.cpp/h     # 通信协议定义
│   └── TcpClient.pro      # 项目配置文件
│
└── TcpServer/             # 服务器程序
    ├── main.cpp           # 服务器入口
    ├── tcpserver.cpp/h    # 服务器主窗口
    ├── mytcpserver.cpp/h  # TCP服务器管理
    ├── mytcpsocket.cpp/h  # Socket连接处理
    ├── opedb.cpp/h        # 数据库操作
    ├── protocol.cpp/h     # 通信协议定义
    └── TcpServer.pro      # 项目配置文件
```

## 编译与运行

### 环境要求

- Qt 6.5.3 或更高版本
- MinGW 64-bit 编译器（Windows）
- C++11 支持

### 编译步骤

#### 1. 编译服务器端

```bash
cd TcpServer
qmake TcpServer.pro
make
```

#### 2. 编译客户端

```bash
cd TcpClient
qmake TcpClient.pro
make
```

### 运行程序

1. 先启动服务器端程序 `TcpServer.exe`
2. 再启动客户端程序 `TcpClient.exe`
3. 可以启动多个客户端进行测试

## 通信协议

系统使用自定义的 PDU (Protocol Data Unit) 协议进行通信：

```cpp
struct PDU {
    uint uiPDULen;  // 总的协议数据单元大小
    uint uiMsgType; // 消息类型
    char caData[64]; // 附加数据
    uint uiMsgLen;  // 实际消息长度
    char caMsg[];    // 实际消息
};
```

支持的消息类型包括：
- 注册/登录请求与响应
- 在线用户查询
- 添加/删除好友
- 私聊/群聊
- 文件操作（创建、上传、下载、删除、重命名）

## 数据库

服务器端使用 SQLite 数据库存储用户信息和好友关系，数据库初始化在服务器启动时自动完成。

## 使用说明

### 用户注册
1. 打开客户端程序
2. 点击"注册"按钮
3. 输入用户名和密码
4. 点击确定完成注册

### 用户登录
1. 在登录界面输入用户名和密码
2. 点击"登录"按钮
3. 登录成功后进入主界面

### 添加好友
1. 点击"添加好友"按钮
2. 输入要添加的用户名
3. 点击搜索
4. 发送好友请求，等待对方同意

### 私聊
1. 在好友列表中双击好友
2. 在私聊窗口中输入消息
3. 按回车或点击发送

### 文件共享
1. 点击"文件共享"标签
2. 可以创建文件夹、上传文件
3. 右键文件可进行下载、删除、重命名等操作

## 开发者信息

本项目使用 Qt Creator 开发，支持跨平台编译。

## 许可证

本项目仅供学习和交流使用。
